# Documentation for the templates used by this generator

Note that all the template files (marked blue on the graph) have `.jinja_template` suffix which is then stripped after generation.

```mermaid
graph TB
  linkStyle default stroke: #888
  classDef black fill: #fff, stroke: #000, stroke-width: 2px
  classDef red fill: #fff, stroke: #f55, stroke-width: 2px
  classDef blue fill: #fff, stroke: #55f, stroke-width: 2px
  classDef green fill: #fff, stroke: #090, stroke-width: 2px

  common.h(common.h)
  ucontext_wrapper.h(ucontext_wrapper.h)
  runner.c(runner.c)
  gather_symbols.py(gather_symbols.py)
  class common.h,ucontext_wrapper.h,runner.c,gather_symbols.py black

  functions.h(functions.h)
  functions.inc(functions.inc)
  decoders.c(decoders.c)
  setup.inc(setup.inc)
  constants.h(constants.h)
  class constants.h,functions.h,functions.inc,decoders.c,setup.inc blue

  gathered_symbols.h(gathered_symbols.h)
  class gathered_symbols.h green

  fb(functions binary)
  rb(runner binary)
  mb(mmap'ed binary)
  class fb,rb,mb red

  constants.h --> common.h

  common.h --> functions.inc
  functions.h --> functions.inc
  functions.inc --> fb

  common.h --> decoders.c
  functions.h --> decoders.c
  decoders.c --> rb

  functions.h --> setup.inc
  functions.inc --> mb
  setup.inc --> mb

  common.h --> runner.c
  ucontext_wrapper.h --> runner.c
  runner.c --> rb

  mb --> gathered_symbols.h
  gather_symbols.py --> gathered_symbols.h

  gathered_symbols.h --> runner.c
```

Legend:
* blue - generated using jinja2.
* red - a binary output of a compiler (these are the outputs we are looking for)
* green - generated by a custom python script.
* black - raw sources

## `functions.h`

This file provides the prototypes of all the structs and functions defined in `function.yml` configuration file (see [here](../config/README.md#functionsyml))
They are all emitted in a format of
```cpp
void setup_{{ TEST_NAME }}(void);
{{ RETURN_VALUE }} test_{{ TEST_NAME }}({{ ARGUMENTS }});
```
where `setup_{{ TEST_NAME }}` is the function to be called by the runner,
and `test_{{ TEST_NAME }}` is the function whose prototype is to be used from the model after the binary is imported.

## `functions.inc`

This file provides the bodies of all the `test_{{ TEST_NAME }}` functions.

## `decoders.inc`

This file provides the way to decode information "dumped" by the functions from `functions.inc` into the final yaml format (see the [relevant doc](../output_format.md)) on a test-by-test basis.

Note that it provides a dispatcher-style function `"decode"` which takes function name as an argument to pass the decoding to the instance of the printer that corresponds to it.

## `setup.inc`

This file provides the bodies of all the `setup_{{ TEST_NAME }}` functions.

## `constants.h`

This file provides a couple of extra values passed from the generator to the script to keep all the configs in [a single place](../config/common.yml) instead of having to update them all over the place when such an update is needed.
